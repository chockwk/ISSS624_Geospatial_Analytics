{
  "hash": "5aba34e22028821abf30bf53aef3baaa",
  "result": {
    "markdown": "---\ntitle: \"1 Choropleth Map\"\nauthor: \"Wan Kee\"\ndate: \"18 November 2023\"\ndate modified: \"20 November 2023\"\nformat: html\nexecute: \n  echo: true\n  eval: true\n  warning: false\neditor: visual\n---\n\n\n# 1.1 Overview\n\nA choropleth map is a thematic map composed of coloured polygons and is used to represent statistical data using the color mapping symbology technique.\n\nLearning Objectives 1. xx 2. xx\n\n# 1.2 Load packages\n\n`knitr` provides a general-purpose tool for dynamic report generation in R using Literate Programming techniques.\n\n`tmap` is a package for interactive maps.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(knitr, tmap, tidyverse, sf)\n```\n:::\n\n\n# 1.3 Import data\n\n::: panel-tabset\n## odbus\n\n\n::: {.cell}\n\n```{.r .cell-code}\nodbus = read_csv(\"data/origin_destination_bus_202308.csv\")\nhead(odbus, n=5)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 7\n  YEAR_MONTH DAY_TYPE         TIME_PER_HOUR PT_TYPE ORIGIN_PT_…¹ DESTI…² TOTAL…³\n  <chr>      <chr>                    <dbl> <chr>   <chr>        <chr>     <dbl>\n1 2023-08    WEEKDAY                     16 BUS     04168        10051         7\n2 2023-08    WEEKENDS/HOLIDAY            16 BUS     04168        10051         2\n3 2023-08    WEEKENDS/HOLIDAY            14 BUS     80119        90079         3\n4 2023-08    WEEKDAY                     14 BUS     80119        90079        10\n5 2023-08    WEEKENDS/HOLIDAY            17 BUS     44069        17229         5\n# … with abbreviated variable names ¹​ORIGIN_PT_CODE, ²​DESTINATION_PT_CODE,\n#   ³​TOTAL_TRIPS\n```\n:::\n:::\n\n\nRows: 5709512 Columns: 7\n\n\n::: {.cell}\n\n```{.r .cell-code}\nodbus$ORIGIN_PT_CODE <- as.factor(odbus$ORIGIN_PT_CODE)\nodbus$DESTINATION_PT_CODE <- as.factor(odbus$DESTINATION_PT_CODE)\n```\n:::\n\n\n## busstop\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbusstop <- st_read(dsn = \"data\",\n                   layer = \"BusStop\") %>%\n  st_transform(crs = 3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `BusStop' from data source \n  `/Users/chockwankee/Documents/chockwk/ISSS624_Geospatial_Analytics/In_class_Ex/In_class_Ex01/data' \n  using driver `ESRI Shapefile'\nSimple feature collection with 5161 features and 3 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 3970.122 ymin: 26482.1 xmax: 48284.56 ymax: 52983.82\nProjected CRS: SVY21\n```\n:::\n:::\n\n\n## mpsz\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz = st_read(dsn=\"data\", layer=\"MPSZ-2019\") %>% \n  st_transform(crs=3414)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `MPSZ-2019' from data source \n  `/Users/chockwankee/Documents/chockwk/ISSS624_Geospatial_Analytics/In_class_Ex/In_class_Ex01/data' \n  using driver `ESRI Shapefile'\nSimple feature collection with 332 features and 6 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 103.6057 ymin: 1.158699 xmax: 104.0885 ymax: 1.470775\nGeodetic CRS:  WGS 84\n```\n:::\n:::\n\n:::\n\n# 1.4 Explore data\n\n::: panel-tabset\n## odbus\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(odbus)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,709,512\nColumns: 7\n$ YEAR_MONTH          <chr> \"2023-08\", \"2023-08\", \"2023-08\", \"2023-08\", \"2023-…\n$ DAY_TYPE            <chr> \"WEEKDAY\", \"WEEKENDS/HOLIDAY\", \"WEEKENDS/HOLIDAY\",…\n$ TIME_PER_HOUR       <dbl> 16, 16, 14, 14, 17, 17, 17, 17, 7, 17, 14, 10, 10,…\n$ PT_TYPE             <chr> \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"BUS\", \"…\n$ ORIGIN_PT_CODE      <fct> 04168, 04168, 80119, 80119, 44069, 44069, 20281, 2…\n$ DESTINATION_PT_CODE <fct> 10051, 10051, 90079, 90079, 17229, 17229, 20141, 2…\n$ TOTAL_TRIPS         <dbl> 7, 2, 3, 10, 5, 4, 3, 22, 3, 3, 7, 1, 3, 1, 3, 1, …\n```\n:::\n:::\n\n\n## busstop\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(busstop)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 5,161\nColumns: 4\n$ BUS_STOP_N <chr> \"22069\", \"32071\", \"44331\", \"96081\", \"11561\", \"66191\", \"2338…\n$ BUS_ROOF_N <chr> \"B06\", \"B23\", \"B01\", \"B05\", \"B05\", \"B03\", \"B02A\", \"B02\", \"B…\n$ LOC_DESC   <chr> \"OPP CEVA LOGISTICS\", \"AFT TRACK 13\", \"BLK 239\", \"GRACE IND…\n$ geometry   <POINT [m]> POINT (13576.31 32883.65), POINT (13228.59 44206.38),…\n```\n:::\n:::\n\n\n## mpsz\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(mpsz)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 332\nColumns: 7\n$ SUBZONE_N  <chr> \"MARINA EAST\", \"INSTITUTION HILL\", \"ROBERTSON QUAY\", \"JURON…\n$ SUBZONE_C  <chr> \"MESZ01\", \"RVSZ05\", \"SRSZ01\", \"WISZ01\", \"MUSZ02\", \"MPSZ05\",…\n$ PLN_AREA_N <chr> \"MARINA EAST\", \"RIVER VALLEY\", \"SINGAPORE RIVER\", \"WESTERN …\n$ PLN_AREA_C <chr> \"ME\", \"RV\", \"SR\", \"WI\", \"MU\", \"MP\", \"WI\", \"WI\", \"SI\", \"SI\",…\n$ REGION_N   <chr> \"CENTRAL REGION\", \"CENTRAL REGION\", \"CENTRAL REGION\", \"WEST…\n$ REGION_C   <chr> \"CR\", \"CR\", \"CR\", \"WR\", \"CR\", \"CR\", \"WR\", \"WR\", \"CR\", \"CR\",…\n$ geometry   <MULTIPOLYGON [m]> MULTIPOLYGON (((33222.98 29..., MULTIPOLYGON (…\n```\n:::\n:::\n\n:::\n\n# 1.5 Extract data\n\n\n::: {.cell}\n\n```{.r .cell-code}\norigin7_9 <- odbus %>%\n  filter(DAY_TYPE == \"WEEKDAY\") %>%\n  filter(TIME_PER_HOUR >= 7 &\n           TIME_PER_HOUR <= 9) %>%\n  group_by(ORIGIN_PT_CODE) %>%\n  summarise(TRIPS = sum(TOTAL_TRIPS))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nkable(head(origin7_9))\n```\n\n::: {.cell-output-display}\n|ORIGIN_PT_CODE | TRIPS|\n|:--------------|-----:|\n|01012          |  1617|\n|01013          |   813|\n|01019          |  1620|\n|01029          |  2383|\n|01039          |  2727|\n|01059          |  1415|\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(origin7_9, \"data/rds/origin7_9.rds\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin7_9 <- read_rds(\"data/rds/origin7_9.rds\")\n```\n:::\n\n\n# 1.6 Combine data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbusstop_mpsz <- st_intersection(busstop, mpsz) %>%\n  select(BUS_STOP_N, SUBZONE_C) %>%\n  st_drop_geometry()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nwrite_rds(busstop_mpsz, \"data/rds/busstop_mpsz.csv\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_data <- left_join(origin7_9 , busstop_mpsz,\n            by = c(\"ORIGIN_PT_CODE\" = \"BUS_STOP_N\")) %>%\n  rename(ORIGIN_BS = ORIGIN_PT_CODE,\n         ORIGIN_SZ = SUBZONE_C)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nduplicate <- origin_data %>%\n  group_by_all() %>%\n  filter(n()>1) %>%\n  ungroup()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\norigin_data <- unique(origin_data)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmpsz_origtrip <- left_join(mpsz, \n                           origin_data,\n                           by = c(\"SUBZONE_C\" = \"ORIGIN_SZ\"))\n```\n:::\n\n\n# 1.7 Choropleth Visualisation\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntm_shape(mpsz_origtrip)+\n  tm_fill(\"TRIPS\", \n          style = \"quantile\", \n          palette = \"Blues\",\n          title = \"Passenger trips\") +\n  tm_layout(main.title = \"Passenger trips generated at planning sub-zone level\",\n            main.title.position = \"center\",\n            main.title.size = 1.2,\n            legend.height = 0.45, \n            legend.width = 0.35,\n            frame = TRUE) +\n  tm_borders(alpha = 0.5) +\n  tm_compass(type=\"8star\", size = 2) +\n  tm_scale_bar() +\n  tm_grid(alpha =0.2) +\n  tm_credits(\"Source: Planning Sub-zone boundary from Urban Redevelopment Authorithy (URA)\\n and Population data from Department of Statistics DOS\", \n             position = c(\"left\", \"bottom\"))\n```\n\n::: {.cell-output-display}\n![](In_class_Ex01_files/figure-html/unnamed-chunk-19-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "In_class_Ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}